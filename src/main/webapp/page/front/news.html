<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" /> 
<script type="text/javascript" src="../../js/jquery1.4.js"></script>
<script type="text/javascript" src="../../js/bioV4.min.js"></script>
<script type="text/javascript" src="../../js/jquery.lazyload.mini.js"></script>
	<script src="../../lib/layer/layer.js"></script>

	<title>新闻详情页</title>
<meta name="Keywords" content="咨询详情页"/>
<meta name="Description" content="咨询详情页"/>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
<link rel="stylesheet" type="text/css" href="../../style/basic.css"/>
<link rel="stylesheet" type="text/css" href="../../style/zx_info.css"/>
<script type="text/javascript" src="../../js/function.js"></script>
<script type="text/javascript" src="../../js/zx_info.js"></script>
<!--[if IE 6]>
<script type="text/javascript" src="../../js/DD_belatedPNG.js"></script>
<script type="text/javascript">
DD_belatedPNG.fix('img,.ie6png');
</script>
<![endif]-->

	<script id="commentsId" type="text/html">
		{{each list value}}
		<li class="cleaarfix p1">
			<div class="left post-img">
				<!--<a href="####"><img src="../../images/hhead.jpg"></a>-->
				<a href="####"><img src="{{value.fromUserImg}}"></a>
				</div>
			<div class="post-info">
				<div style="margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">{{value.fromUserName}}</a>
					<!--<span class="fc999">4 分钟前</span>-->
				</div>
				<div class="fc666 b-5">{{value.content}}</div>
				<div>
					<a href="javascript:void(0);" data-id="{{value.id}}" class="comment_reply_comment">回复</a>
					</div>
				</div>

			{{each value.list value2}}
			<div class="comments2List" style="margin: 10px 0 0 65px;">
				<div class="left post-img">
					<a href="####"><img src="{{value2.fromUserImg}}" alt="标题标题"></a>
					</div>
				<div class="post-info">
					<div style="margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">{{value2.fromUserName}}</a>
						<!--<span class="fc999">4 分钟前</span>-->
					</div>
					<div class="fc666 b-5">{{value2.content}}</div>
					</div>
				</div>
			{{/each}}

			<div class="clear"></div>
			</li>
		{{/each}}
	</script>

</head>
<body>
	<script type="text/javascript" src="../../js/borsertocss.js"> </script><!-- 判断在IE9以下浏览器中根据像素的不同而设置的样式 -->
 
  <!--头部代码开始-->
	<header id="headBox"></header>
    
<script type="text/javascript">
	$(function(){
		var Interval_control = '';
		var current_index = 0;
		show_pic_ad = function(index){
			$(".top-ad .pull-left").each(function(i){
				$(this).hide();
				if(i == index){
					$(this).show(); 
				}
			});
		};
		show_point_ad = function(index){
			$(".top-ad .slides-ad-point a").each(function(i){
				if($(this).hasClass("icon-css-on")){
					$(this).removeClass("icon-css-on");
					$(this).addClass("icon-css");
				}
				if(i == index){
					if($(this).hasClass("icon-css")){
						$(this).removeClass("icon-css");
					}
					$(this).addClass("icon-css-on");
				}
			});
		};
		slides = function(){
			$(".slides-ad-point a").each(function(index){
				$(this).click(function(){
					current_index = index;
					show_point_ad(index);
					show_pic_ad(current_index);
				});
			});
		};
		slides();
		Interval_control = setInterval(function(){
			show_point_ad(current_index);
			show_pic_ad(current_index);
			if (current_index == ($(".slides-icon-ad a").length - 1)){
				current_index = -1;
			}
			current_index ++;
		},5000);//设置自动切换函数
		//当触发mouseenter事件时，取消正在执行的自动切换方法，触发mouseouter事件时重新设置自动切换
		$(".top-ad .pull-left").mouseenter(function() {
			clearInterval(Interval_control);//停止自动切换
		}).mouseleave(function(){
			Interval_control = setInterval(function(){
				show_point_ad(current_index);
				show_pic_ad(current_index);
				if (current_index == ($(".top-ad .pull-left").length - 1)){
					current_index = -1;
				}
				current_index ++;
			},5000);//设置自动切换函数
		});
	});
</script>

<!--头部代码结束-->

 	<div class="hr tp-div-nexthr" style="margin-top: 0;margin-bottom: 0;padding: 0;"></div>
	<div class="container pb-15">
	<!-- Example row of columns -->
	<div class="row">
		<div class="span16">
       
   
 <!--内容页面-->     
                        
  <div class="label-div b-30 border-all pt-5 t-20" style="position: relative; padding-left: 0;">
   
  
   <!--<div class="mmdh pull-left"><a href="">首页</a> > <a href="">投资机构</a> > <a href="">机构标题</a></div> -->
   <!--<div class="mmkey pull-right"><b><a href="">关键字</a></b><b><a href="">关键字</a></b><b><a href="">关键字</a></b><div class="mmclear"></div></div> -->
  
   <div class="mmclear"></div>
   
   
   
   
   <div style="margin-top: 14px;" class="clearfix pb-12 pl-25 pr-25">
						<h1 class="pull-left r-10" id="newsTitle"></h1>
						<div class="pull-left pt-5 none-768" style="_margin-top:-33px; _margin-left:-10px;"> 
                        <span class="like-plug-gz clearfix pull-left r-15">
                        <span class="count pull-left t-5 d-none"></span>
                        </span>
                        </div>
	</div>
   
 
   
  <div style="margin-top: 4px;" class="clearfix pl-25 pr-25">
						<div class="pull-left">
				 
				<span class="r-15 pull-left"><span class="fc999 l-5" id="newsDate"></span></span>
				 <!--<span class="r-15 pull-left"><span class="fc999 l-5">涉及行业：软件</span></span>-->
			    <!--<span class="fc999 l-20 pull-left">涉及公司：-->
                	<!--<span data-obj="News" data-oid="104437" id="obj_hits" class="fc999">Google</span>-->
                <!--</span>-->
		</div> 
 </div> 
  
 <div class="view-main t-20 pl-25 pr-25">
    
    <div class="view-content" style="margin-top: 18px;">

    </div>

  </div>
   
  <!--警告：切勿删除-->
  <!--[if IE 6]> <a class="follow-btn ie6png mmmzw"></a><![endif]--> 

</div>

<!--讨论区-->

<div id="comment_div" class="t-10 label-div border-all pr-20 pt-50 pl-20">
	 <!-- 评论箱  -->
     <div class="comment"><div class="comment_box_comment" id="comment-box">
	<div class="post-div">
	<form action="javascript:;" id="form_comment" name="form_comment">
	<div class="user-img">
    <a title="游客" href="javascript:;">
    <img alt="游客" src="../../images/uuuser.jpg">
    </a>
    </div>
		<div class="weiboComments">
			
            <div class="com-textarea ie6png">
				<input type="hidden" value="News" id="data_obj_type" name="data[obj_type]">
	            <input type="hidden" value="104437" id="data_obj_id" name="data[obj_id]">
	            <input type="hidden" value="" id="data_uid" name="data[uid]">
	            <input type="hidden" value="0" id="data_pid" name="data[pid]">
	            <input type="hidden" value="" id="data_share" name="data[share]">
	            <input type="hidden" value="aHR0cDovL3d3dy5iaW9kaXNjb3Zlci5jb20vbmV3cy9wb2xpdGljcy8xMDQ0MzcuaHRtbCNDQw==" id="data_url" name="data[url]">
				<textarea id="commentBoxId" style="_width: 98%;"></textarea>
				<!--<span class="head-msg">还可以输入<span id="remLen">140</span>字</span>-->
				<span style="color: #000;position: absolute;left: 0;top: -35px;height: 22px;line-height: 20px;font-family: '微软雅黑';font-size: 14px;">讨论区：</span>
			</div>

			<div class="post-toolbar">
				<div class="post-options"></div>
				<button id="commentBtn" style="background-color: #CF261F;color: #fff;
padding: 5px 20px;">评论</button>
				<!-- loadding -->
			</div>
		</div>
	</form>	
	</div>
	<div class="comments-info clearfix">
		<div class="comments-tab left"><a href="javascript:void(0);"><span class="rows_count">0</span> 条评论</a></div>
		 
	</div>
	<ul class="comments-list clearfix">

      <!--<li class="cleaarfix p1">-->
				<!--<div class="left post-img">-->
					<!--<a href="####"><img src="../../images/hhead.jpg" alt="标题标题"></a>-->
				<!--</div>-->
				<!--<div class="post-info">-->
					<!--<div style="line-height: 16px;margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">张三</a><span class="fc999">4 分钟前</span></div>-->
					<!--<div class="fc666 b-5">内容内容内容内容内容内容内容内容</div>-->
					<!--<div>-->
						<!--<a href="javascript:void(0);" class="comment_reply_comment">回复</a>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="comments2List" style="margin-left: 65px;margin-top: 10px;">-->
					<!--<div class="left post-img">-->
						<!--<a href="####"><img src="../../images/hhead.jpg" alt="标题标题"></a>-->
					<!--</div>-->
					<!--<div class="post-info">-->
						<!--<div style="line-height: 16px;margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">张三</a><span class="fc999">4 分钟前</span></div>-->
						<!--<div class="fc666 b-5">内容内容内容内容内容内容内容内容</div>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="clear"></div>-->
			<!--</li>-->

</ul>
	<div data-by="desc" data-size="12" data-url="/comment/commentList.html?class=comment&amp;type=News&amp;id=104437" data-page="1" onclick="comment_list('.comment_box_comment')" class="load load_more d-none" style="display: none;"><a title="加载更多" href="javascript:void(0);">加载更多</a></div>
	<div class="load load_loading" style="display: none;"><a title="正在加载" href="javascript:void(0);"> 正在加载</a></div>
	<div class="load load_none d-none" style="display: none;"><a title="没有更早的了" href="javascript:void(0);">没有更早的了</a></div>
</div>

</div>
			</div>

<!--讨论区结束-->

</div>
 
	</div>
</div>

<!--右侧代码结束-->

<!-- /container -->

  <div class="container">
 
 	<div class="hr"></div>
    
    </div>
  
<!-- /container -->

</div>

<div class="footer">
		 
		 
			<div class="clearfix" style="background:#EDEDED;">
				
			</div>
    
    <div class="friend-link border-all t-20 b-20">
		<ul class="clearfix">
		
	</ul>
</div>
  <script type="text/javascript">
	$(document).ready(function(){
		var flag = 0;
		$(".friend-link").hide();
		//Down
		$("#zk_btn").click(function(){
			if(flag == 0){
				$(".friend-link").slideDown(400); 
				$(this).removeClass('down-class');
				$(this).addClass('up-class');
				$("html,body").animate({scrollTop:($(".friend-link").offset().top+2000)},600);
				flag = 1;
			}else{
				$(".friend-link").slideUp(400);  
				$(this).removeClass('up-class');
				$(this).addClass('down-class'); 
				flag = 0;
			}
		});
	});
</script>
	<div id="content"></div>
<p>Copyright ©2013　　备8888888888号</p>
    
		</div> 

<script type="text/javascript">
/*<![CDATA[*/
jQuery(function($){
$('.add-emote').live('click',function(){get_face2face(this,'face.html')});
$('.face_title div').live('click',function(){face2face(this)});
$('.add_comment_submit').live('click',function(){add_comment_submit_fn(this,$(this).parents('form').attr('id'))});

});
/*]]>*/
</script>
	<script type="text/javascript" src="../../lib/template-web.js"></script>
	<script type="text/javascript" src="../../js/public/headjs.js"></script><script type="text/javascript">
//回到顶部
backToTop('body');

var addSession = window.sessionStorage.getItem("add");
if(addSession){
  layer.msg("评论成功", {time: 2000, icon: 1});
  window.sessionStorage.removeItem("add");
}

function getMyDate(str){
  var oDate = new Date(str),
      oYear = oDate.getFullYear(),
      oMonth = oDate.getMonth()+1,
      oDay = oDate.getDate(),
      oHour = oDate.getHours(),
      oMin = oDate.getMinutes(),
      oSen = oDate.getSeconds(),
      oTime = oYear +'-'+ getzf(oMonth) +'-'+ getzf(oDay) +' '+ getzf(oHour) +':'+ getzf(oMin) +':'+ getzf(oSen);//最后拼接时间
  return oTime;
}
//补0操作
function getzf(num){
  if(parseInt(num) < 10){
    num = '0'+num;
  }
  return num;
}

function getUrlData(name){
  var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
  var r = decodeURIComponent(window.location.search.substr(1)).match(reg);  //匹配目标参数
  if (r != null) return unescape(r[2]); return null; //返回参数值
}

var urlId = getUrlData('id');
var topicid = getUrlData('topicid');
var userId = window.sessionStorage.getItem("userId");
var userName = window.sessionStorage.getItem("userName");

// 获取新闻详情
var getNewsData = new FormData();
getNewsData.append("postId", urlId);
getNewsData.append("topicId", topicid);
if (userId) {
  getNewsData.append("userId", userId);
}

$.ajax({
  type: "post",
  url: "../../post/getPostByPostId",
  // contentType: "application/json;charset=utf-8",
  contentType: false,//这里
  processData: false,//这两个一定设置为false
  dataType: "json",
  data: getNewsData,
  success: function (data) {
    $("#newsTitle").html(data.post.postName);
    $("#newsDate").html(getMyDate(data.post.createTime));
    $(".view-content").html(data.post.content);
  }
});

//获取评论
var commentsData = new FormData();
commentsData.append("PostId", urlId);
$.ajax({
  type: "post",
  url: "../../comment/getCommentsByPost",
  // contentType: "application/json;charset=utf-8",
  contentType: false,//这里
  processData: false,//这两个一定设置为false
  dataType: "json",
  data: commentsData,
  success: function (r) {
    var comment1List = [];
    var comment2List = [];
    for(i in r.commentList){
      if(r.commentList[i].toCommentId != 0){
        comment2List.push(r.commentList[i])
      } else {
        comment1List.push(r.commentList[i])
      }
    }
		for(a in comment1List){
      comment1List[a].list = []
      for(b in comment2List){
				if(comment1List[a].id == comment2List[b].toCommentId){
          comment1List[a].list.push(comment2List[b])
				}
      }
		}
//    comment1List.forEach(function (item, index) {
//      item.list.forEach(function (item2, index2) {
//        $(".comments-list").append('<li class="cleaarfix p1">' +
//            '<div class="left post-img">' +
//            '<a href="####"><img src="../../images/hhead.jpg"></a>' +
//            '</div>' +
//            '<div class="post-info">' +
//            '<div style="line-height: 16px;margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">张三</a><span class="fc999">4 分钟前</span></div>' +
//            '<div class="fc666 b-5">' + item.content + '</div>' +
//            '<div>' +
//            '<a href="javascript:void(0);" data-id="' + item.id + '" class="comment_reply_comment">回复</a>' +
//            '</div>' +
//            '</div>' +
//
//            '<div class="comments2List" style="margin: 10px 0 0 65px;">' +
//            '<div class="left post-img">' +
//            '<a href="####"><img src="../../images/hhead.jpg" alt="标题标题"></a>' +
//            '</div>' +
//            '<div class="post-info">' +
//            '<div style="line-height: 16px;margin-bottom: 9px;"><a class="fs14 r-10" target="_blank" href="####">张三</a><span class="fc999">4 分钟前</span></div>' +
//        		'<div class="fc666 b-5">' + item2.content + '</div>' +
//            '</div>' +
//            '</div>' +
//
//            '<div class="clear"></div>' +
//            '</li>');
//      })
//    });
		var templateData = {
		  list: comment1List
		};
    var html = template('commentsId', templateData);
    $(".comments-list").append(html);
    $(".rows_count").html(r.commentList.length);

  }
});

// 评论
$("body").on("click", "#commentBtn", function () {
  if(userName){
    if($("#commentBoxId").val() != ''){
      var formData = new FormData();
      formData.append("fromUserId", userId);
      formData.append("fromUserName", userName);
      formData.append("toCommentId", 0);
      formData.append("toPostId", urlId);
      formData.append("content", $("#commentBoxId").val());
      $.ajax({
        type: "post",
        url: "../../comment/addComment",
        // contentType: "application/json;charset=utf-8",
        contentType: false,//这里
        processData: false,//这两个一定设置为false
        dataType: "json",
        data: formData,
        success: function (data) {
          if(data && data.resultCode == 200){
            window.sessionStorage.setItem("add", true);
            window.location.reload();
          } else {
            layer.msg(data.resultMessage, {time: 2000, icon: 2});
          }
        }
      })
		} else {
      layer.msg('请输入评论内容', {time: 2000, icon: 0});
    }
	} else {
    layer.msg('请先登录', {time: 2000, icon: 0});
	}

});

// 回复评论
$("body").on("click", ".comment_reply_comment", function () {
  var thisId = $(this).attr("data-id");
  layer.open({
    btn: ['确认', '取消'],
    title: '回复评论',
    skin: 'my-skin',
    btnAlign: 'c',
    scrollbar: false,
    area: ['500px', '200px'],
    content: '<div><span>内容：</span><textarea class="topicNameInput" style="width: 380px;"></textarea></div>',
    yes: function(index, layero){
      //按钮【按钮一】的回调
      var formData = new FormData();
      formData.append("fromUserId", userId);
      formData.append("fromUserName", userName);
      formData.append("toCommentId", thisId);
      formData.append("toPostId", urlId);
      formData.append("content", $(".topicNameInput").val());
      $.ajax({
        type: "post",
        url: "../../comment/addComment",
        // contentType: "application/json;charset=utf-8",
        contentType: false,//这里
        processData: false,//这两个一定设置为false
        dataType: "json",
        data: formData,
        success: function (data) {
          if(data && data.resultCode == 200){
            window.sessionStorage.setItem("add", true);
            window.location.reload();
          } else {
            layer.msg(data.resultMessage, {time: 2000, icon: 2});
          }
        }
      })
    }
  });
})

</script>
</body>
</html>
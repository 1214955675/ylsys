
<!DOCTYPE HTML>
<html>
<head>
<title>后台管理系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
 <!-- Bootstrap Core CSS -->
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/bootstrap-3.3.4.css">
<!-- Custom CSS -->
<link href="css/style.css" rel='stylesheet' type='text/css' />
<!-- Graph CSS -->
<link href="css/lines.css" rel='stylesheet' type='text/css' />
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css"> 
<!-- jQuery -->
<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>

<!---//webfonts--->  
<!-- Nav CSS -->
<link href="css/custom.css" rel="stylesheet">
<!-- Metis Menu Plugin JavaScript -->
<script src="js/metisMenu.min.js"></script>
<script src="js/custom.js"></script>
<!-- Graph JavaScript -->
<script src="js/d3.v3.js"></script>
<script src="js/rickshaw.js"></script>
</head>
<body>
<div id="wrapper">
     <!-- Navigation -->
	<header id="headBox"></header>
        <!--<nav class="top1 navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">-->
            <!--<div class="navbar-header">-->
                <!--<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">-->
                    <!--<span class="sr-only">Toggle navigation</span>-->
                    <!--<span class="icon-bar"></span>-->
                    <!--<span class="icon-bar"></span>-->
                    <!--<span class="icon-bar"></span>-->
                <!--</button>-->
                <!--<a class="navbar-brand" href="index.html">医疗社交服务平台</a>-->
            <!--</div>-->
            <!--&lt;!&ndash; /.navbar-header &ndash;&gt;-->
            <!--<ul class="nav navbar-nav navbar-right">-->
				<!--<li class="dropdown">-->
	        		<!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-comments-o"></i><span class="badge">4</span></a>-->
	        		<!--<ul class="dropdown-menu">-->
						<!--<li class="dropdown-menu-header">-->
							<!--<strong>Messages</strong>-->
							<!--<div class="progress thin">-->
							  <!--<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">-->
							    <!--<span class="sr-only">40% Complete (success)</span>-->
							  <!--</div>-->
							<!--</div>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/1.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
								<!--<span class="label label-info">NEW</span>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/2.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
								<!--<span class="label label-info">NEW</span>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/3.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/4.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/5.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="avatar">-->
							<!--<a href="#">-->
								<!--<img src="images/pic1.png" alt=""/>-->
								<!--<div>New message</div>-->
								<!--<small>1 minute ago</small>-->
							<!--</a>-->
						<!--</li>-->
						<!--<li class="dropdown-menu-footer text-center">-->
							<!--<a href="#">View all messages</a>-->
						<!--</li>	-->
	        		<!--</ul>-->
	      		<!--</li>-->
			    <!--<li class="dropdown">-->
	        		<!--<a href="#" class="dropdown-toggle avatar" data-toggle="dropdown"><img src="images/1.png"><span class="badge">9</span></a>-->
	        		<!--<ul class="dropdown-menu">-->
						<!--<li class="dropdown-menu-header text-center">-->
							<!--<strong>Account</strong>-->
						<!--</li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-bell-o"></i> Updates <span class="label label-info">42</span></a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-envelope-o"></i> Messages <span class="label label-success">42</span></a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-tasks"></i> Tasks <span class="label label-danger">42</span></a></li>-->
						<!--<li><a href="#"><i class="fa fa-comments"></i> Comments <span class="label label-warning">42</span></a></li>-->
						<!--<li class="dropdown-menu-header text-center">-->
							<!--<strong>Settings</strong>-->
						<!--</li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-user"></i> Profile</a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-wrench"></i> Settings</a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-usd"></i> Payments <span class="label label-default">42</span></a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-file"></i> Projects <span class="label label-primary">42</span></a></li>-->
						<!--<li class="divider"></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-shield"></i> Lock Profile</a></li>-->
						<!--<li class="m_2"><a href="#"><i class="fa fa-lock"></i> Logout</a></li>	-->
	        		<!--</ul>-->
	      		<!--</li>-->
			<!--</ul>-->
			<!--<form class="navbar-form navbar-right">-->
              <!--<input type="text" class="form-control" value="Search..." onFocus="this.value = '';" onBlur="if (this.value == '') {this.value = 'Search...';}">-->
            <!--</form>-->
            <!--<div class="navbar-default sidebar" role="navigation">-->
                <!--<div class="sidebar-nav navbar-collapse">-->
                    <!--<ul class="nav" id="side-menu">-->
                        <!--<li>-->
                            <!--<a href="index.html"><i class="fa fa-dashboard fa-fw nav_icon"></i>首页</a>-->
                        <!--</li>-->
                        <!--<li>-->
                            <!--<a href="#"><i class="fa fa-laptop nav_icon"></i>Layouts<span class="fa arrow"></span></a>-->
                            <!--<ul class="nav nav-second-level">-->
                                <!--<li>-->
                                    <!--<a href="grids.html">Grid System</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--&lt;!&ndash; /.nav-second-level &ndash;&gt;-->
                        <!--</li>-->
                        <!--<li>-->
                            <!--<a href="#"><i class="fa fa-indent nav_icon"></i>Menu Levels<span class="fa arrow"></span></a>-->
                            <!--<ul class="nav nav-second-level">-->
                                <!--<li>-->
                                    <!--<a href="graphs.html">Graphs</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="typography.html">Typography</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--&lt;!&ndash; /.nav-second-level &ndash;&gt;-->
                        <!--</li>-->
                        <!--<li>-->
                            <!--<a href="#"><i class="fa fa-envelope nav_icon"></i>Mailbox<span class="fa arrow"></span></a>-->
                            <!--<ul class="nav nav-second-level">-->
                                <!--<li>-->
                                    <!--<a href="inbox.html">Inbox</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="compose.html">Compose email</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--&lt;!&ndash; /.nav-second-level &ndash;&gt;-->
                        <!--</li>-->
                        <!--<li>-->
                            <!--<a href="####"><i class="fa fa-flask nav_icon"></i>widgets</a>-->
                        <!--</li>-->
                         <!--<li>-->
                            <!--<a href="#"><i class="fa fa-check-square-o nav_icon"></i>Forms<span class="fa arrow"></span></a>-->
                            <!--<ul class="nav nav-second-level">-->
                                <!--<li>-->
                                    <!--<a href="forms.html">Basic Forms</a>-->
                                <!--</li>-->
                                <!--<li>-->
                                    <!--<a href="validation.html">Validation</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--&lt;!&ndash; /.nav-second-level &ndash;&gt;-->
                        <!--</li>-->
                        <!--<li>-->
                            <!--<a href="#"><i class="fa fa-table nav_icon"></i>Tables<span class="fa arrow"></span></a>-->
                            <!--<ul class="nav nav-second-level">-->
                                <!--<li>-->
                                    <!--<a href="basic_tables.html">Basic Tables</a>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--&lt;!&ndash; /.nav-second-level &ndash;&gt;-->
                        <!--</li>-->
                        <!--<li>                            <a href="feedback.html"><i class="fa fa-flask nav_icon"></i>问题反馈</a>                        </li>-->
                    <!--</ul>-->
                <!--</div>-->
                <!--&lt;!&ndash; /.sidebar-collapse &ndash;&gt;-->
            <!--</div>-->
            <!--&lt;!&ndash; /.navbar-static-side &ndash;&gt;-->
        <!--</nav>-->

        <div id="page-wrapper">
        <div class="graphs">
     	<!--<div class="col_3">-->
        	<!--<div class="col-md-3 widget widget1">-->
        		<!--<div class="r3_counter_box">-->
                    <!--<i class="pull-left fa fa-thumbs-up icon-rounded"></i>-->
                    <!--<div class="stats">-->
                      <!--<h5><strong>45%</strong></h5>-->
                      <!--<span>New Orders</span>-->
                    <!--</div>-->
                <!--</div>-->
        	<!--</div>-->
        	<!--<div class="col-md-3 widget widget1">-->
        		<!--<div class="r3_counter_box">-->
                    <!--<i class="pull-left fa fa-users user1 icon-rounded"></i>-->
                    <!--<div class="stats">-->
                      <!--<h5><strong>1019</strong></h5>-->
                      <!--<span>New Visitors</span>-->
                    <!--</div>-->
                <!--</div>-->
        	<!--</div>-->
        	<!--<div class="col-md-3 widget widget1">-->
        		<!--<div class="r3_counter_box">-->
                    <!--<i class="pull-left fa fa-comment user2 icon-rounded"></i>-->
                    <!--<div class="stats">-->
                      <!--<h5><strong>1012</strong></h5>-->
                      <!--<span>New Users</span>-->
                    <!--</div>-->
                <!--</div>-->
        	<!--</div>-->
        	<!--<div class="col-md-3 widget">-->
        		<!--<div class="r3_counter_box">-->
                    <!--<i class="pull-left fa fa-dollar dollar1 icon-rounded"></i>-->
                    <!--<div class="stats">-->
                      <!--<h5><strong>$450</strong></h5>-->
                      <!--<span>Profit Today</span>-->
                    <!--</div>-->
                <!--</div>-->
        	 <!--</div>-->
        	<!--<div class="clearfix"> </div>-->
      <!--</div>-->

					<!----Calender -------->
					<link rel="stylesheet" href="css/clndr.css" type="text/css" />
					<script src="js/underscore-min.js" type="text/javascript"></script>
					<script src= "js/moment-2.2.1.js" type="text/javascript"></script>
					<script src="js/clndr.js" type="text/javascript"></script>
					<script src="js/site.js" type="text/javascript"></script>
					<!----End Calender -------->

    <div class="content_bottom">
     <div class="col-md-12 span_3">
		  <div class="bs-example1" data-example-id="contextual-table">
				<div>
					<button type="submit" class="btn btn-primary addTopicBtn">新建圈子</button>
				</div>
		    <table class="table">
		      <thead>
		        <tr>
		          <th>#</th>
		          <th>ID</th>
		          <th>名称</th>
		          <th></th>
		        </tr>
		      </thead>
		      <tbody class="topicTbody">

		      </tbody>
		    </table>
		   </div>
	   </div>
		<div class="clearfix"> </div>
	    </div>
		<div class="copy">
           <p>Copyright &copy; 2015 </p>
	    </div>
		</div>
       </div>
      <!-- /#page-wrapper -->
   </div>
    <!-- /#wrapper -->
    <!-- Bootstrap Core JavaScript -->
    <script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
	<script type="text/javascript" src="../../lib/template-web.js"></script>
<script type="text/javascript" src="js/adminHead.js"></script>
    <script src="../../lib/layer/layer.js"></script>
<script>
	$(function () {
	  var editSession = window.sessionStorage.getItem("edit");
	  var delSession = window.sessionStorage.getItem("del");
	  var addSession = window.sessionStorage.getItem("add");
	  if(editSession){
      layer.msg("修改成功", {time: 2000, icon: 1});
      window.sessionStorage.removeItem("edit");
		}
    if(delSession){
      layer.msg("删除成功", {time: 2000, icon: 1});
      window.sessionStorage.removeItem("del");
    }
    if(addSession){
      layer.msg("新增成功", {time: 2000, icon: 1});
      window.sessionStorage.removeItem("add");
    }

    //获取圈子
    var alltopicData = new FormData();
    alltopicData.append("page", 1);
    alltopicData.append("limit", 10000);
    $.ajax({
      type: "post",
      url: "../../topic/getalltopic",
      // contentType: "application/json;charset=utf-8",
      contentType: false,//这里
      processData: false,//这两个一定设置为false
      dataType: "json",
      data: alltopicData,
      success: function (data) {
        if(data && data.resultCode == 200){
          data.topicList.forEach(function (item, index) {
            $(".topicTbody").append('<tr>' +
																		'<th>' + (index + 1) + '</th>' +
																		'<td>' + item.id + '</td>' +
																		'<td>' + item.topicName + '</td>' +
																		'<td>' +
								'<a href="javascript: void(0);" data-id="' + item.id + '" data-name="' + item.topicName + '" class="edit" style="margin-right: 10px;">编辑</a>' +
								'<a href="javascript: void(0);" data-id="' + item.id + '" class="del" style="margin-right: 10px;">删除</a>' +
								'<a href="widgets.html?id=' + item.id + '" class="del">查看新闻</a>' +
								'</td>' +
																		'</tr>');
          });
        }
      }
    });

    //新建圈子
    $("body").on("click", ".addTopicBtn", function () {
      layer.open({
        btn: ['确认', '取消'],
        title: '新增',
        skin: 'my-skin',
        btnAlign: 'c',
        scrollbar: false,
        area: ['500px', '200px'],
        content: '<div style="display: flex;margin-bottom: 10px;"><span>图片：</span><input id="fileId" type="file"></div><div><span>名称：</span><input class="addTopicNameInput"></div>',
        yes: function(index, layero){
          //按钮【按钮一】的回调
          var addTopicNameInputVal = $(".addTopicNameInput").val();
          var formData = new FormData();
          formData.append("postNum", 0);
          formData.append("topicName", addTopicNameInputVal);
          formData.append("file", document.getElementById("fileId").files[0]);

          $.ajax({
            type: "post",
            url: "../../topic/addTopic",
            // contentType: "application/json;charset=utf-8",
            contentType: false,//这里
            processData: false,//这两个一定设置为false
            dataType: "json",
            data: formData,
            success: function (data) {
              if(data && data.resultCode == 200){
                window.sessionStorage.setItem("add", true);
                window.location.reload();
              } else {
                layer.msg(data.resultMessage, {time: 2000, icon: 2});
              }
            },
            error: function (err) {
              layer.msg("异常", {time: 2000, icon: 2});
            }
          })
        }
      });
    });

		//编辑圈子
		$("body").on("click", ".edit", function () {
		  var thisName = $(this).attr("data-name");
		  var thisId = $(this).attr("data-id");
      layer.open({
        btn: ['确认', '取消'],
        title: '编辑',
        skin: 'my-skin',
        btnAlign: 'c',
        scrollbar: false,
        area: ['500px', '200px'],
        content: '<div><span>名称：</span><input class="topicNameInput"></div>',
				yes: function(index, layero){
          //按钮【按钮一】的回调
					var topicNameVal = $(".topicNameInput").val();
          var formData = new FormData();
          formData.append("id", thisId);
          formData.append("topicName", topicNameVal);
          formData.append("imgUrl", '');
          $.ajax({
            type: "post",
            url: "../../topic/updateTopic",
            // contentType: "application/json;charset=utf-8",
            contentType: false,//这里
            processData: false,//这两个一定设置为false
            dataType: "json",
            data: formData,
            success: function (data) {
              if(data && data.resultCode == 200){
                window.sessionStorage.setItem("edit", true);
                window.location.reload();
              } else {
                layer.msg(data.resultMessage, {time: 2000, icon: 2});
							}
            },
            error: function (err) {
              layer.msg("异常", {time: 2000, icon: 2});
            }
          })
        }
      });
      $(".topicNameInput").val(thisName);
    });

    //删除圈子
    $("body").on("click", ".del", function () {
      var thisId = $(this).attr("data-id");
      var formData = new FormData();
      formData.append("id", thisId);

      layer.confirm('是否删除？', {
        title: "删除提示",
        btn: ['确定', '取消']
      }, function () {
        $.ajax({
          type: "post",
          url: "../../topic/delTopic",
          // contentType: "application/json;charset=utf-8",
          contentType: false,//这里
          processData: false,//这两个一定设置为false
          dataType: "json",
          data: formData,
          success: function (data) {
            if(data && data.resultCode == 200){
              window.sessionStorage.setItem("del", true);
              window.location.reload();
            } else {
              layer.msg(data.resultMessage, {time: 2000, icon: 2});
            }
          },
          error: function (err) {
            layer.msg("异常", {time: 2000, icon: 2});
          }
        });
      });


    });

  });
</script>
</body>
</html>
